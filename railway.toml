[build]
builder = "nixpacks"

[nixpacks]
setup = [
    "apt-get update",
    "apt-get install -y software-properties-common",
    "add-apt-repository -y ppa:mc3man/trusty-media",
    "apt-get update",
    "apt-get install -y ffmpeg opus-tools libffi-dev libnacl-dev python3-dev",
    "apt-get install -y build-essential",
    "ln -s /usr/bin/ffmpeg /usr/local/bin/ffmpeg",
    "python -m pip install --upgrade pip"
]

[deploy]
startCommand = "python main.py"
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

[phases.setup]
nixPkgs = []
aptPkgs = [
    "ffmpeg",
    "opus-tools",
    "libffi-dev",
    "libnacl-dev",
    "python3-dev",
    "build-essential",
    "pkg-config"
]

[phases.build]
cmds = [
    "which ffmpeg",
    "ffmpeg -version",
    "ls -l /usr/bin/ffmpeg",
    "ls -l /usr/local/bin/ffmpeg"
]
