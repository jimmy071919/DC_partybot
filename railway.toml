[build]
builder = "nixpacks"

[nixpacks]
setup = [
    "apt-get update",
    "apt-get install -y ffmpeg opus-tools libffi-dev libnacl-dev python3-dev",
    "apt-get install -y build-essential",
    "python -m pip install --upgrade pip"
]

[deploy]
startCommand = "python main.py"
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

[phases.setup]
nixPkgs = ["ffmpeg", "opus", "gcc", "python3-dev", "make"]

[phases.build]
cmds = [
    "which ffmpeg",
    "ffmpeg -version"
]
